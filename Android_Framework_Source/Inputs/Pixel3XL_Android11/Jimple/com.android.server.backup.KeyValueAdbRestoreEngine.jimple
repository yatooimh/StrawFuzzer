public class com.android.server.backup.KeyValueAdbRestoreEngine extends java.lang.Object implements java.lang.Runnable
{
    private static final boolean DEBUG;
    private static final java.lang.String TAG;
    private final android.app.IBackupAgent mAgent;
    private final com.android.server.backup.UserBackupManagerService mBackupManagerService;
    private final java.io.File mDataDir;
    private final android.os.ParcelFileDescriptor mInFD;
    private final com.android.server.backup.FileMetadata mInfo;
    private final int mToken;

    public void <init>(com.android.server.backup.UserBackupManagerService, java.io.File, com.android.server.backup.FileMetadata, android.os.ParcelFileDescriptor, android.app.IBackupAgent, int)
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        com.android.server.backup.UserBackupManagerService r1;
        java.io.File r2;
        com.android.server.backup.FileMetadata r3;
        android.os.ParcelFileDescriptor r4;
        android.app.IBackupAgent r5;
        int i0;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

        r1 := @parameter0: com.android.server.backup.UserBackupManagerService;

        r2 := @parameter1: java.io.File;

        r3 := @parameter2: com.android.server.backup.FileMetadata;

        r4 := @parameter3: android.os.ParcelFileDescriptor;

        r5 := @parameter4: android.app.IBackupAgent;

        i0 := @parameter5: int;

        specialinvoke r0.<java.lang.Object: void <init>()>();

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: com.android.server.backup.UserBackupManagerService mBackupManagerService> = r1;

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: java.io.File mDataDir> = r2;

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: com.android.server.backup.FileMetadata mInfo> = r3;

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: android.os.ParcelFileDescriptor mInFD> = r4;

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: android.app.IBackupAgent mAgent> = r5;

        r0.<com.android.server.backup.KeyValueAdbRestoreEngine: int mToken> = i0;

        return;
    }

    private void copyKeysInLexicalOrder(android.app.backup.BackupDataInput, android.app.backup.BackupDataOutput) throws java.io.IOException
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        android.app.backup.BackupDataOutput r1;
        int i0, $i1, $i3;
        java.util.HashMap $r3;
        java.util.ArrayList $r4;
        java.util.Set $r5;
        boolean $z0, $z1;
        java.lang.Object $r6, $r7;
        android.app.backup.BackupDataInput r9;
        java.lang.String r10, r14;
        byte[] r11, r15;
        java.util.Iterator r13;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

        r9 := @parameter0: android.app.backup.BackupDataInput;

        r1 := @parameter1: android.app.backup.BackupDataOutput;

        $r3 = new java.util.HashMap;

        specialinvoke $r3.<java.util.HashMap: void <init>()>();

     label1:
        $z1 = virtualinvoke r9.<android.app.backup.BackupDataInput: boolean readNextHeader()>();

        if $z1 == 0 goto label3;

        r10 = virtualinvoke r9.<android.app.backup.BackupDataInput: java.lang.String getKey()>();

        i0 = virtualinvoke r9.<android.app.backup.BackupDataInput: int getDataSize()>();

        if i0 >= 0 goto label2;

        virtualinvoke r9.<android.app.backup.BackupDataInput: void skipEntityData()>();

        goto label1;

     label2:
        r11 = newarray (byte)[i0];

        virtualinvoke r9.<android.app.backup.BackupDataInput: int readEntityData(byte[],int,int)>(r11, 0, i0);

        interfaceinvoke $r3.<java.util.Map: java.lang.Object put(java.lang.Object,java.lang.Object)>(r10, r11);

        goto label1;

     label3:
        $r4 = new java.util.ArrayList;

        $r5 = interfaceinvoke $r3.<java.util.Map: java.util.Set keySet()>();

        specialinvoke $r4.<java.util.ArrayList: void <init>(java.util.Collection)>($r5);

        staticinvoke <java.util.Collections: void sort(java.util.List)>($r4);

        r13 = interfaceinvoke $r4.<java.util.List: java.util.Iterator iterator()>();

     label4:
        $z0 = interfaceinvoke r13.<java.util.Iterator: boolean hasNext()>();

        if $z0 == 0 goto label5;

        $r6 = interfaceinvoke r13.<java.util.Iterator: java.lang.Object next()>();

        r14 = (java.lang.String) $r6;

        $r7 = interfaceinvoke $r3.<java.util.Map: java.lang.Object get(java.lang.Object)>(r14);

        r15 = (byte[]) $r7;

        $i1 = lengthof r15;

        virtualinvoke r1.<android.app.backup.BackupDataOutput: int writeEntityHeader(java.lang.String,int)>(r14, $i1);

        $i3 = lengthof r15;

        virtualinvoke r1.<android.app.backup.BackupDataOutput: int writeEntityData(byte[],int)>(r15, $i3);

        goto label4;

     label5:
        return;
    }

    private void invokeAgentForAdbRestore(android.app.IBackupAgent, com.android.server.backup.FileMetadata, java.io.File) throws java.io.IOException
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        java.io.File r1, $r6, r22;
        java.lang.StringBuilder $r3, $r11, $r16;
        java.lang.String $r7, $r14, $r19, r23;
        com.android.server.backup.UserBackupManagerService $r8;
        long $l0;
        int $i1;
        android.app.backup.IBackupManager $r9;
        java.lang.Throwable $r10;
        android.os.RemoteException $r15;
        android.app.IBackupAgent r20;
        com.android.server.backup.FileMetadata r21;
        android.os.ParcelFileDescriptor r25, r26;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

        r20 := @parameter0: android.app.IBackupAgent;

        r21 := @parameter1: com.android.server.backup.FileMetadata;

        r22 := @parameter2: java.io.File;

        r23 = r21.<com.android.server.backup.FileMetadata: java.lang.String packageName>;

        r1 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: java.io.File mDataDir>;

        $r3 = new java.lang.StringBuilder;

        specialinvoke $r3.<java.lang.StringBuilder: void <init>()>();

        virtualinvoke $r3.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(r23);

        virtualinvoke $r3.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(".new");

        $r6 = new java.io.File;

        $r7 = virtualinvoke $r3.<java.lang.StringBuilder: java.lang.String toString()>();

        specialinvoke $r6.<java.io.File: void <init>(java.io.File,java.lang.String)>(r1, $r7);

     label1:
        r25 = staticinvoke <android.os.ParcelFileDescriptor: android.os.ParcelFileDescriptor open(java.io.File,int)>(r22, 268435456);

        r26 = staticinvoke <android.os.ParcelFileDescriptor: android.os.ParcelFileDescriptor open(java.io.File,int)>($r6, 1006632960);

        $l0 = r21.<com.android.server.backup.FileMetadata: long version>;

        $i1 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: int mToken>;

        $r8 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: com.android.server.backup.UserBackupManagerService mBackupManagerService>;

        $r9 = virtualinvoke $r8.<com.android.server.backup.UserBackupManagerService: android.app.backup.IBackupManager getBackupManagerBinder()>();

        interfaceinvoke r20.<android.app.IBackupAgent: void doRestore(android.os.ParcelFileDescriptor,long,android.os.ParcelFileDescriptor,int,android.app.backup.IBackupManager)>(r25, $l0, r26, $i1, $r9);

     label2:
        goto label5;

     label3:
        $r15 := @caughtexception;

        $r16 = new java.lang.StringBuilder;

        specialinvoke $r16.<java.lang.StringBuilder: void <init>()>();

        virtualinvoke $r16.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>("Exception calling doRestore on agent: ");

        virtualinvoke $r16.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.Object)>($r15);

        $r19 = virtualinvoke $r16.<java.lang.StringBuilder: java.lang.String toString()>();

        staticinvoke <android.util.Slog: int e(java.lang.String,java.lang.String)>("KeyValueAdbRestoreEngine", $r19);

        goto label5;

     label4:
        $r10 := @caughtexception;

        $r11 = new java.lang.StringBuilder;

        specialinvoke $r11.<java.lang.StringBuilder: void <init>()>();

        virtualinvoke $r11.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>("Exception opening file. ");

        virtualinvoke $r11.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.Object)>($r10);

        $r14 = virtualinvoke $r11.<java.lang.StringBuilder: java.lang.String toString()>();

        staticinvoke <android.util.Slog: int e(java.lang.String,java.lang.String)>("KeyValueAdbRestoreEngine", $r14);

     label5:
        return;

        catch java.io.IOException from label1 to label2 with label4;
        catch android.os.RemoteException from label1 to label2 with label3;
    }

    private java.io.File prepareRestoreData(com.android.server.backup.FileMetadata, android.os.ParcelFileDescriptor) throws java.io.IOException
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        com.android.server.backup.FileMetadata r1;
        android.os.ParcelFileDescriptor r2;
        java.io.File r3, $r7, $r12, r15;
        java.lang.StringBuilder $r4, $r9;
        java.lang.String $r8, $r13, r14;
        long $l0, $l1, $l3;
        int $i2;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

        r1 := @parameter0: com.android.server.backup.FileMetadata;

        r2 := @parameter1: android.os.ParcelFileDescriptor;

        r14 = r1.<com.android.server.backup.FileMetadata: java.lang.String packageName>;

        r15 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: java.io.File mDataDir>;

        $r4 = new java.lang.StringBuilder;

        specialinvoke $r4.<java.lang.StringBuilder: void <init>()>();

        virtualinvoke $r4.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(r14);

        virtualinvoke $r4.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(".restore");

        $r7 = new java.io.File;

        $r8 = virtualinvoke $r4.<java.lang.StringBuilder: java.lang.String toString()>();

        specialinvoke $r7.<java.io.File: void <init>(java.io.File,java.lang.String)>(r15, $r8);

        r3 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: java.io.File mDataDir>;

        $r9 = new java.lang.StringBuilder;

        specialinvoke $r9.<java.lang.StringBuilder: void <init>()>();

        virtualinvoke $r9.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(r14);

        virtualinvoke $r9.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>(".sorted");

        $r12 = new java.io.File;

        $r13 = virtualinvoke $r9.<java.lang.StringBuilder: java.lang.String toString()>();

        specialinvoke $r12.<java.io.File: void <init>(java.io.File,java.lang.String)>(r3, $r13);

        $l3 = r1.<com.android.server.backup.FileMetadata: long size>;

        $i2 = r1.<com.android.server.backup.FileMetadata: int type>;

        $l1 = r1.<com.android.server.backup.FileMetadata: long mode>;

        $l0 = r1.<com.android.server.backup.FileMetadata: long mtime>;

        staticinvoke <android.app.backup.FullBackup: void restoreFile(android.os.ParcelFileDescriptor,long,int,long,long,java.io.File)>(r2, $l3, $i2, $l1, $l0, $r7);

        specialinvoke r0.<com.android.server.backup.KeyValueAdbRestoreEngine: void sortKeyValueData(java.io.File,java.io.File)>($r7, $r12);

        return $r12;
    }

    private void sortKeyValueData(java.io.File, java.io.File) throws java.io.IOException
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        java.io.FileDescriptor $r1, $r2;
        java.lang.Throwable $r3;
        java.io.File r4, r5;
        java.io.FileInputStream r6, r8;
        java.io.FileOutputStream r7, r10;
        android.app.backup.BackupDataInput r12;
        android.app.backup.BackupDataOutput r13;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

        r4 := @parameter0: java.io.File;

        r5 := @parameter1: java.io.File;

        r6 = null;

        r7 = null;

     label01:
        r8 = new java.io.FileInputStream;

     label02:
        r6 = null;

        r7 = null;

     label03:
        specialinvoke r8.<java.io.FileInputStream: void <init>(java.io.File)>(r4);

     label04:
        r6 = r8;

        r7 = null;

     label05:
        r10 = new java.io.FileOutputStream;

     label06:
        r6 = r8;

        r7 = null;

     label07:
        specialinvoke r10.<java.io.FileOutputStream: void <init>(java.io.File)>(r5);

     label08:
        r6 = r8;

        r7 = r10;

     label09:
        r12 = new android.app.backup.BackupDataInput;

     label10:
        r6 = r8;

        r7 = r10;

     label11:
        $r1 = virtualinvoke r8.<java.io.FileInputStream: java.io.FileDescriptor getFD()>();

        specialinvoke r12.<android.app.backup.BackupDataInput: void <init>(java.io.FileDescriptor)>($r1);

     label12:
        r6 = r8;

        r7 = r10;

     label13:
        r13 = new android.app.backup.BackupDataOutput;

     label14:
        r6 = r8;

        r7 = r10;

     label15:
        $r2 = virtualinvoke r10.<java.io.FileOutputStream: java.io.FileDescriptor getFD()>();

        specialinvoke r13.<android.app.backup.BackupDataOutput: void <init>(java.io.FileDescriptor)>($r2);

     label16:
        r6 = r8;

        r7 = r10;

     label17:
        specialinvoke r0.<com.android.server.backup.KeyValueAdbRestoreEngine: void copyKeysInLexicalOrder(android.app.backup.BackupDataInput,android.app.backup.BackupDataOutput)>(r12, r13);

     label18:
        staticinvoke <libcore.io.IoUtils: void closeQuietly(java.lang.AutoCloseable)>(r8);

        staticinvoke <libcore.io.IoUtils: void closeQuietly(java.lang.AutoCloseable)>(r10);

        return;

     label19:
        $r3 := @caughtexception;

        if r6 == null goto label20;

        staticinvoke <libcore.io.IoUtils: void closeQuietly(java.lang.AutoCloseable)>(r6);

     label20:
        if r7 == null goto label21;

        staticinvoke <libcore.io.IoUtils: void closeQuietly(java.lang.AutoCloseable)>(r7);

     label21:
        throw $r3;

        catch java.lang.Throwable from label01 to label02 with label19;
        catch java.lang.Throwable from label03 to label04 with label19;
        catch java.lang.Throwable from label05 to label06 with label19;
        catch java.lang.Throwable from label07 to label08 with label19;
        catch java.lang.Throwable from label09 to label10 with label19;
        catch java.lang.Throwable from label11 to label12 with label19;
        catch java.lang.Throwable from label13 to label14 with label19;
        catch java.lang.Throwable from label15 to label16 with label19;
        catch java.lang.Throwable from label17 to label18 with label19;
    }

    public void run()
    {
        com.android.server.backup.KeyValueAdbRestoreEngine r0;
        android.os.ParcelFileDescriptor $r1;
        com.android.server.backup.FileMetadata $r2, $r3;
        android.app.IBackupAgent $r4;
        java.lang.Throwable $r5;
        java.io.File r6;
        java.io.IOException r8;

        r0 := @this: com.android.server.backup.KeyValueAdbRestoreEngine;

     label1:
        $r2 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: com.android.server.backup.FileMetadata mInfo>;

        $r1 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: android.os.ParcelFileDescriptor mInFD>;

        r6 = specialinvoke r0.<com.android.server.backup.KeyValueAdbRestoreEngine: java.io.File prepareRestoreData(com.android.server.backup.FileMetadata,android.os.ParcelFileDescriptor)>($r2, $r1);

        $r4 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: android.app.IBackupAgent mAgent>;

        $r3 = r0.<com.android.server.backup.KeyValueAdbRestoreEngine: com.android.server.backup.FileMetadata mInfo>;

        specialinvoke r0.<com.android.server.backup.KeyValueAdbRestoreEngine: void invokeAgentForAdbRestore(android.app.IBackupAgent,com.android.server.backup.FileMetadata,java.io.File)>($r4, $r3, r6);

     label2:
        goto label4;

     label3:
        $r5 := @caughtexception;

        r8 = (java.io.IOException) $r5;

        virtualinvoke r8.<java.io.IOException: void printStackTrace()>();

     label4:
        return;

        catch java.io.IOException from label1 to label2 with label3;
    }

    public static void <clinit>()
    {
        <com.android.server.backup.KeyValueAdbRestoreEngine: java.lang.String TAG> = "KeyValueAdbRestoreEngine";

        <com.android.server.backup.KeyValueAdbRestoreEngine: boolean DEBUG> = 0;

        return;
    }
}
